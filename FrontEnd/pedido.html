<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pedido Finalizado</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    body {
      background-color: #000;
      color: #fff;
      font-family: 'DM Sans', sans-serif;
      height: 90vh;
    }

    .navbar {
      background-color: #24D301;
    }

    .navbar-brand img {
      height: 30px;
    }

    .navbar-toggler-icon {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='black' stroke-width='2' stroke-linecap='round' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
    }

    .titulo {
      display: flex;
      align-items: center;
      margin: 1rem;
    }

    h3 {
      padding-left: 0.5rem;
      font-size: 1.8rem;
      font-weight: 700;
    }

    .divider {
      height: 1px;
      background-color: #e3e3e3;
      margin: 0.5rem 1rem;
    }

    .card-section {
      background-color: #000;
      border: 1px solid #ffffff;
      border-radius: 8px;
      padding: 1.5rem;
      margin: 1.5rem;
    }

    .card-section h6 {
      font-weight: 700;
      border-bottom: 1px solid #ffffff;
      padding-bottom: 0.5rem;
      margin-bottom: 1rem;
      font-size: 1.1rem;
    }

    .item-line {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }

    .item-line .price {
      font-weight: 600;
    }

    .mensagem-final {
      color: #ff3333;
      font-weight: 700;
      text-align: center;
      text-transform: uppercase;
      margin-top: 2rem;
      line-height: 1.6;
    }

    .btn-voltar {
      background-color: #24D301;
      color: #000;
      font-weight: 600;
      width: 90%;
      max-width: 350px;
      border-radius: 8px;
      padding: 0.8rem;
      display: block;
      margin: 2rem auto;
      text-align: center;
      text-decoration: none;
    }

    .btn-voltar:hover {
      background-color: #2ff500;
      color: #000;
    }

/* ============================
   RESPONSIVIDADE GLOBAL
   (aplicar em todas as páginas)
   ============================ */

/* Tablets em diante (>= 768px) */
@media (min-width: 768px) {

  /* Evita body travado em 90vh */
  body {
    height: auto;
    min-height: 100vh;
  }

  /* Centraliza e limita largura dos principais blocos de conteúdo */
  .titulo,
  .title,
  .divider,
  .sobre-nos,
  .texto,
  .card-section,
  .event-info,
  form,
  .total-input,
  .mensagem-final {
    max-width: 960px;
    margin-left: auto;
    margin-right: auto;
  }

  /* Dá um respiro maior no topo da página */
  .titulo,
  .title {
    margin-top: 1.5rem;
  }

  /* Blocos com “card-section” padronizados */
  .card-section {
    margin-top: 1.5rem;
    margin-bottom: 1.5rem;
  }

  /* Informações de evento ficam mais organizadas em telas médias+ */
  .event-info {
    gap: 1.5rem;
  }

  .event-info img {
    max-width: 160px;
    width: 100%;
    height: auto;
  }

  /* Botões principais com largura confortável em desktop */
  .btn-cart,
  .btn-confirmar,
  .btn-finalizar,
  .btn-voltar {
    width: 100%;
    max-width: 360px;
  }

  /* Telas tipo “conteúdo único” (ex: embarque / resumo) mais compactas */
  .content {
    max-width: 640px;
    margin-left: auto;
    margin-right: auto;
  }
}

/* Monitores grandes (>= 1200px) */
@media (min-width: 1200px) {

  .titulo,
  .title,
  .divider,
  .sobre-nos,
  .texto,
  .card-section,
  .event-info,
  form,
  .total-input,
  .mensagem-final {
    max-width: 1040px;
  }

  /* Se tiver banner na home, ele fica com largura controlada,
     sem ficar “perdido” em telas muito largas */
  .banner-container {
    max-width: 1200px;
    margin-left: auto;
    margin-right: auto;
  }
}

  .banner-container {
    max-width: 1200px;
    margin-left: auto;
    margin-right: auto;
  }

  </style>
</head>

<body>

 <nav class="navbar navbar-dark" style="background-color: #24D301;">
  <div class="container-fluid d-flex justify-content-between align-items-center ms-1 me-1">

    <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#menuLateral" aria-controls="menuLateral">
      <span class="navbar-toggler-icon"></span>
    </button>

    <a class="navbar-brand fw-bold text-dark" href="#">
      <img src="./assets/img/logo.png" alt="Logo" height="30">
    </a>

    <div class="d-flex align-items-center gap-3">
  <a href="carrinho.html" class="text-dark position-relative" aria-label="Abrir carrinho">
    <i class="bi bi-cart3 fs-2"></i>
    <span id="cart-count-badge"
          class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
          style="display:none; font-size:.7rem; min-width:1.1rem; height:1.1rem; padding:0; line-height:1.1rem;">
      0
    </span>
  </a>
  <a href="conta.html" class="text-dark" aria-label="Minha conta">
    <i class="bi bi-person-circle fs-2"></i>
  </a>
</div>
</nav>

  <div class="offcanvas offcanvas-start text-bg-dark" tabindex="-1" id="menuLateral" aria-labelledby="menuLateralLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="menuLateralLabel">Menu</h5>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Fechar"></button>
    </div>
    <div class="offcanvas-body">
      <ul class="list-unstyled">
        <li><a href="index.html" class="text-white text-decoration-none d-block py-2">Eventos</a></li>
        <li><a href="sobre.html" class="text-white text-decoration-none d-block py-2">Sobre Nós</a></li>
        <li><a href="#" class="text-white text-decoration-none d-block py-2">Conta</a></li>
        <li><a href="#" class="text-white text-decoration-none d-block py-2">Sair</a></li>
      </ul>
      <div class="d-flex justify-content-start gap-4 mt-3">
        <a href="#" class="text-white fs-1"><i class="bi bi-instagram"></i></a>
        <a href="#" class="text-white fs-1"><i class="bi bi-tiktok"></i></a>
        <a href="#" class="text-white fs-1"><i class="bi bi-whatsapp"></i></a>
      </div>
    </div>
  </div>

  <section class="titulo">
    <a href="index.html" class="text-white fs-2 text-decoration-none p-1">
      <i class="bi bi-arrow-left"></i>
    </a>
    <h3 class="title fw-bold mb-0">Pedido Finalizado</h3>
  </section>

  <div class="divider"></div>

 <div class="card-section">
  <h6>Pedido <span id="order-id">#----</span></h6>

  <div id="order-items"></div>
  <hr>

  <div class="item-line">
    <strong>Total da Compra:</strong>
    <strong class="price" id="order-total">R$ 0,00</strong>
  </div>

  <p class="mensagem-final">
    AGUARDE, EM BREVE NOSSO PROMOTER ENTRARÁ EM CONTATO VIA WHATSAPP<br>
    PARA CONFIRMAR O PEDIDO
  </p>
</div>

  <a href="index.html" class="btn-voltar">Voltar para Início</a>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>


<script>
  const LAST_ORDER_KEY = 'order:last';
  const money = new Intl.NumberFormat('pt-BR', {
    style: 'currency',
    currency: 'BRL'
  });

  function loadLastOrder() {
    try {
      const raw = localStorage.getItem(LAST_ORDER_KEY);
      if (!raw) return null;
      return JSON.parse(raw);
    } catch (e) {
      console.error('Erro ao ler order:last do localStorage:', e);
      return null;
    }
  }

  function renderOrder() {
    const orderIdEl     = document.getElementById('order-id');
    const orderTotalEl  = document.getElementById('order-total');
    const itemsContainer = document.getElementById('order-items');

    if (!orderIdEl || !orderTotalEl || !itemsContainer) {
      console.warn('Elementos #order-id, #order-total ou #order-items não encontrados.');
      return;
    }

    const order = loadLastOrder();
    console.log('Pedido carregado de order:last:', order);

    if (!order) {
      orderIdEl.textContent = '----';
      orderTotalEl.textContent = money.format(0);
      itemsContainer.innerHTML = '';
      return;
    }

    // ID do pedido
    orderIdEl.textContent = order.id ?? order.backendId ?? '----';

    itemsContainer.innerHTML = '';

    // pode vir "itens" (backend) ou "items" (snapshot)
    const itens = order.itens || order.items || [];
    let total = 0;

    for (const it of itens) {
      // nome pode vir como evento_nome (backend) ou name (snapshot)
      const nome = it.evento_nome || it.nome || it.name || 'Ingresso';

      // quantidade pode ser "quantidade" (backend) ou "qty" (snapshot)
      const qtd = Number(
        it.quantidade ?? it.qty ?? 1
      );

      let subtotal = 0;

      if (it.subtotal != null) {
        // formato backend já calculado
        subtotal = Number(it.subtotal);
      } else {
        // formato snapshot ou fallback
        const unitFromSnapshot = it.unitPrice != null ? Number(it.unitPrice) : null;
        const pIng = it.preco_ingresso != null ? Number(it.preco_ingresso) : 0;
        const pExc = it.preco_excursao != null ? Number(it.preco_excursao) : 0;

        const unit = unitFromSnapshot != null
          ? unitFromSnapshot
          : (pIng + pExc);

        subtotal = unit * qtd;
      }

      total += subtotal;

      const row = document.createElement('div');
      row.className = 'item-line';
      row.innerHTML = `
        <span>${nome} x${qtd}</span>
        <span class="price">${money.format(subtotal)}</span>
      `;
      itemsContainer.appendChild(row);
    }

    // Se por algum motivo o loop não somou nada, usa o total salvo
    if (!total) {
      if (order.valor_total != null) {
        total = Number(order.valor_total);
      } else if (order.total != null) {
        total = Number(order.total);
      }
    }

    orderTotalEl.textContent = money.format(total);
  }

  document.addEventListener('DOMContentLoaded', renderOrder);
</script>


<script>
(function () {
  const CART_KEY = 'cart:v1';
  const badgeEl = document.getElementById('cart-count-badge');
  if (!badgeEl) return;

  function getCount() {
    try {
      const state = JSON.parse(localStorage.getItem(CART_KEY) || '{"items":[]}');
      return (state.items || []).reduce((sum, it) => sum + (parseInt(it.qty, 10) || 0), 0);
    } catch { return 0; }
  }

  function renderBadge() {
    const n = getCount();
    badgeEl.textContent = n;
    badgeEl.style.display = n > 0 ? 'inline-block' : 'none';
  }

  renderBadge();
  window.addEventListener('storage', (e) => { if (e.key === CART_KEY) renderBadge(); });

  if (window.CartStore && typeof window.CartStore.save === 'function') {
    const originalSave = window.CartStore.save.bind(window.CartStore);
    window.CartStore.save = function (state) {
      const r = originalSave(state);
      renderBadge();
      return r;
    };
  }

  window.updateCartCountBadge = renderBadge;
})();
</script>

<script src="js/cart-badge.js"></script>

</body>
</html>
